---
import { getCollection } from 'astro:content';
import Newspaper from '../layouts/Newspaper.astro';
import Masthead from '../components/Masthead.astro';
import Article from '../components/Article.astro';
import Ticker from '../components/Ticker.astro';

// Get today's edition (Feb 15, 2027 in future timeline)
const editionDate = "Saturday, February 15, 2027";
const editionSlug = "2027-02-15";

// Fetch all articles from this edition
const allArticles = await getCollection('editions');
const editionArticles = allArticles.filter(article => 
  article.id.startsWith(editionSlug)
);

// Organize articles by section
const frontPage = editionArticles.find(a => a.data.section === 'front-page');
const world = editionArticles.find(a => a.data.section === 'world');
const tech = editionArticles.find(a => a.data.section === 'tech');
const business = editionArticles.find(a => a.data.section === 'business');
const culture = editionArticles.find(a => a.data.section === 'culture');
const opinion = editionArticles.find(a => a.data.section === 'opinion');

// Render article content
const frontPageContent = frontPage ? await frontPage.render() : null;
const worldContent = world ? await world.render() : null;
const techContent = tech ? await tech.render() : null;
const businessContent = business ? await business.render() : null;
const cultureContent = culture ? await culture.render() : null;
const opinionContent = opinion ? await opinion.render() : null;

const tickerItems = [
  { text: "S&P 500 closes at 7,047 (+3.8% this week) as rate cut hopes surge" },
  { text: "Bitcoin reaches $132,000 amid institutional buying and ETF inflows" },
  { text: "Senate AI regulation bill clears committee 14-8, full vote expected March" },
  { text: "Milano Cortina Winter Olympics face warmest temperatures on record" },
  { text: "Google's quantum chip breaks RSA-2048, accelerating encryption crisis" },
  { text: "Ukraine war enters fourth year with no diplomatic breakthrough in sight" },
  { text: "Federal Reserve holds rates at 4.25%, Powell warns against premature easing" },
];
---

<Newspaper title="Front Page" date={editionDate}>
  <Masthead date={editionDate} />
  
  <div class="front-page">
    <div class="front-page-lead">
      {frontPage && frontPageContent && (
        <Article 
          headline={frontPage.data.title}
          byline={frontPage.data.author}
          size={frontPage.data.size || 'major'}
          confidence={frontPage.data.confidence}
          columns={frontPage.data.columns || 2}
        >
          <frontPageContent.Content />
        </Article>
      )}
    </div>
  </div>
  
  <Ticker items={tickerItems} />
  
  <hr class="rule rule-thick" />
  
  <h2 class="section-header">World Affairs</h2>
  
  {world && worldContent && (
    <Article 
      headline={world.data.title}
      byline={world.data.author}
      size={world.data.size || 'secondary'}
      confidence={world.data.confidence}
    >
      <worldContent.Content />
    </Article>
  )}
  
  <hr class="rule rule-thick" />
  
  <h2 class="section-header">Technology & Science</h2>
  
  {tech && techContent && (
    <Article 
      headline={tech.data.title}
      byline={tech.data.author}
      size={tech.data.size || 'secondary'}
      confidence={tech.data.confidence}
    >
      <techContent.Content />
    </Article>
  )}
  
  <hr class="rule rule-thick" />
  
  <h2 class="section-header">Business & Markets</h2>
  
  {business && businessContent && (
    <Article 
      headline={business.data.title}
      byline={business.data.author}
      size={business.data.size || 'secondary'}
      confidence={business.data.confidence}
    >
      <businessContent.Content />
    </Article>
  )}
  
  <hr class="rule rule-thick" />
  
  <h2 class="section-header">Culture & Sports</h2>
  
  {culture && cultureContent && (
    <Article 
      headline={culture.data.title}
      byline={culture.data.author}
      size={culture.data.size || 'standard'}
      confidence={culture.data.confidence}
    >
      <cultureContent.Content />
    </Article>
  )}
  
  <hr class="rule rule-thick" />
  
  <h2 class="section-header">Opinion</h2>
  
  {opinion && opinionContent && (
    <Article 
      headline={opinion.data.title}
      byline={opinion.data.author}
      size={opinion.data.size || 'standard'}
    >
      <opinionContent.Content />
    </Article>
  )}
</Newspaper>
